import React, { useEffect, useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Sparkles, Star, Crown, Gem, Share2, Download } from 'lucide-react';
import { RarityType, getRarityDisplay } from '@/services/raritySystem';
import RarityBadge from './RarityBadge';\n\ninterface RarityCelebrationProps {\n  rarity: RarityType;\n  petName: string;\n  petImage?: string;\n  onClose: () => void;\n  onShare?: () => void;\n  onDownload?: () => void;\n  autoClose?: boolean;\n  autoCloseDelay?: number;\n}\n\nconst RarityCelebration: React.FC<RarityCelebrationProps> = ({\n  rarity,\n  petName,\n  petImage,\n  onClose,\n  onShare,\n  onDownload,\n  autoClose = false,\n  autoCloseDelay = 5000\n}) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [showFireworks, setShowFireworks] = useState(false);\n  \n  const rarityConfig = getRarityDisplay(rarity);\n  const isHighRarity = ['epic', 'legendary', 'secret_rare'].includes(rarity);\n  \n  useEffect(() => {\n    // Trigger entrance animation\n    const timer = setTimeout(() => {\n      setIsVisible(true);\n      if (isHighRarity) {\n        setShowFireworks(true);\n      }\n    }, 100);\n    \n    return () => clearTimeout(timer);\n  }, [isHighRarity]);\n  \n  useEffect(() => {\n    if (autoClose) {\n      const timer = setTimeout(() => {\n        handleClose();\n      }, autoCloseDelay);\n      \n      return () => clearTimeout(timer);\n    }\n  }, [autoClose, autoCloseDelay]);\n  \n  const handleClose = () => {\n    setIsVisible(false);\n    setTimeout(onClose, 300); // Wait for exit animation\n  };\n  \n  const getCelebrationMessage = () => {\n    switch (rarity) {\n      case 'secret_rare':\n        return {\n          title: 'ðŸŽ‰ INCREDIBLE! ðŸŽ‰',\n          subtitle: 'You discovered a Secret Rare!',\n          message: `${petName} is an ultra-rare find! This is a once-in-a-lifetime card that only the luckiest collectors obtain.`\n        };\n      case 'legendary':\n        return {\n          title: 'ðŸ‘‘ LEGENDARY! ðŸ‘‘',\n          subtitle: 'A mythical card appears!',\n          message: `${petName} has achieved legendary status! This magnificent card is the stuff of legends.`\n        };\n      case 'epic':\n        return {\n          title: 'âš¡ EPIC! âš¡',\n          subtitle: 'An extraordinary discovery!',\n          message: `${petName} is truly epic! This rare card showcases exceptional beauty and charm.`\n        };\n      case 'rare':\n        return {\n          title: 'âœ¨ RARE! âœ¨',\n          subtitle: 'A special card!',\n          message: `${petName} is a rare find! This card stands out from the ordinary with its unique appeal.`\n        };\n      case 'uncommon':\n        return {\n          title: 'ðŸŒŸ Nice! ðŸŒŸ',\n          subtitle: 'An uncommon card!',\n          message: `${petName} has some special qualities that make it stand out!`\n        };\n      default:\n        return {\n          title: 'ðŸ“¸ Great Shot! ðŸ“¸',\n          subtitle: 'A solid card!',\n          message: `${petName} makes for a wonderful pet card!`\n        };\n    }\n  };\n  \n  const celebration = getCelebrationMessage();\n  \n  const getRarityIcon = (size = 'w-20 h-20') => {\n    const iconClass = `${size} mx-auto mb-4`;\n    \n    switch (rarity) {\n      case 'secret_rare':\n        return <Gem className={`${iconClass} text-pink-400 animate-bounce`} />;\n      case 'legendary':\n        return <Crown className={`${iconClass} text-amber-400 animate-bounce`} />;\n      case 'epic':\n        return <Sparkles className={`${iconClass} text-violet-400 animate-bounce`} />;\n      case 'rare':\n        return <Star className={`${iconClass} text-blue-400 animate-bounce`} />;\n      case 'uncommon':\n        return <Star className={`${iconClass} text-emerald-400 animate-bounce`} />;\n      default:\n        return <Star className={`${iconClass} text-gray-400 animate-bounce`} />;\n    }\n  };\n  \n  const getBackgroundEffect = () => {\n    if (!isHighRarity) return '';\n    \n    switch (rarity) {\n      case 'secret_rare':\n        return 'bg-gradient-to-br from-pink-500/20 via-purple-500/20 to-blue-500/20';\n      case 'legendary':\n        return 'bg-gradient-to-br from-amber-500/20 via-yellow-500/20 to-orange-500/20';\n      case 'epic':\n        return 'bg-gradient-to-br from-violet-500/20 via-purple-500/20 to-indigo-500/20';\n      default:\n        return '';\n    }\n  };\n  \n  return (\n    <div className={`\n      fixed inset-0 z-50 flex items-center justify-center p-4\n      bg-black/50 backdrop-blur-sm\n      transition-all duration-300\n      ${isVisible ? 'opacity-100' : 'opacity-0'}\n    `}>\n      {/* Fireworks effect for high rarities */}\n      {showFireworks && isHighRarity && (\n        <div className=\"absolute inset-0 pointer-events-none overflow-hidden\">\n          {[...Array(12)].map((_, i) => (\n            <div\n              key={i}\n              className=\"absolute w-2 h-2 bg-yellow-300 rounded-full animate-ping\"\n              style={{\n                top: `${10 + Math.random() * 80}%`,\n                left: `${10 + Math.random() * 80}%`,\n                animationDelay: `${Math.random() * 2}s`,\n                animationDuration: `${1 + Math.random()}s`\n              }}\n            />\n          ))}\n          {[...Array(8)].map((_, i) => (\n            <div\n              key={`star-${i}`}\n              className=\"absolute w-3 h-3 text-yellow-300 animate-pulse\"\n              style={{\n                top: `${20 + Math.random() * 60}%`,\n                left: `${20 + Math.random() * 60}%`,\n                animationDelay: `${Math.random() * 3}s`\n              }}\n            >\n              âœ¨\n            </div>\n          ))}\n        </div>\n      )}\n      \n      <Card className={`\n        max-w-md w-full mx-auto\n        transform transition-all duration-500\n        ${isVisible ? 'scale-100 translate-y-0' : 'scale-95 translate-y-4'}\n        ${getBackgroundEffect()}\n        border-2\n        shadow-2xl\n      `}\n      style={{\n        borderColor: rarityConfig.glowColor,\n        boxShadow: `0 0 30px ${rarityConfig.glowColor}40`\n      }}>\n        <CardContent className=\"p-8 text-center\">\n          {/* Rarity Icon */}\n          <div className=\"relative\">\n            {getRarityIcon()}\n            \n            {/* Rotating glow effect for high rarities */}\n            {isHighRarity && (\n              <div \n                className=\"absolute inset-0 rounded-full opacity-30 animate-spin\"\n                style={{\n                  background: `conic-gradient(from 0deg, transparent, ${rarityConfig.color}, transparent)`,\n                  animationDuration: '3s'\n                }}\n              />\n            )}\n          </div>\n          \n          {/* Title */}\n          <h2 className=\"text-3xl font-bold mb-2 animate-pulse\">\n            {celebration.title}\n          </h2>\n          \n          {/* Subtitle */}\n          <p className=\"text-lg text-gray-600 mb-4\">\n            {celebration.subtitle}\n          </p>\n          \n          {/* Pet Image */}\n          {petImage && (\n            <div className=\"w-32 h-32 mx-auto mb-4 relative\">\n              <img \n                src={petImage} \n                alt={petName}\n                className=\"w-full h-full object-cover rounded-lg shadow-lg\"\n              />\n              <div \n                className=\"absolute inset-0 rounded-lg\"\n                style={{\n                  boxShadow: `inset 0 0 20px ${rarityConfig.glowColor}30`\n                }}\n              />\n            </div>\n          )}\n          \n          {/* Rarity Badge */}\n          <div className=\"mb-4\">\n            <RarityBadge rarity={rarity} size=\"lg\" showEffects={true} />\n          </div>\n          \n          {/* Pet Name */}\n          <h3 className=\"text-2xl font-bold mb-4\" style={{ color: rarityConfig.color }}>\n            {petName}\n          </h3>\n          \n          {/* Message */}\n          <p className=\"text-gray-600 mb-6 leading-relaxed\">\n            {celebration.message}\n          </p>\n          \n          {/* Rarity Stats */}\n          <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div>\n                <div className=\"text-gray-500\">Rarity</div>\n                <div className=\"font-semibold\">{rarityConfig.displayName}</div>\n              </div>\n              <div>\n                <div className=\"text-gray-500\">Multiplier</div>\n                <div className=\"font-semibold\">{rarityConfig.multiplier}x</div>\n              </div>\n            </div>\n          </div>\n          \n          {/* Action Buttons */}\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            {onShare && (\n              <Button\n                onClick={onShare}\n                variant=\"outline\"\n                className=\"flex-1\"\n              >\n                <Share2 className=\"w-4 h-4 mr-2\" />\n                Share\n              </Button>\n            )}\n            \n            {onDownload && (\n              <Button\n                onClick={onDownload}\n                variant=\"outline\"\n                className=\"flex-1\"\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                Download\n              </Button>\n            )}\n            \n            <Button\n              onClick={handleClose}\n              className=\"flex-1\"\n              style={{\n                backgroundColor: rarityConfig.color,\n                borderColor: rarityConfig.color\n              }}\n            >\n              Continue\n            </Button>\n          </div>\n          \n          {/* Auto-close indicator */}\n          {autoClose && (\n            <div className=\"mt-4 text-xs text-gray-500\">\n              Auto-closing in {Math.ceil(autoCloseDelay / 1000)} seconds...\n            </div>\n          )}\n        </CardContent>\n      </Card>\n      \n      {/* Background sparkles for secret rare */}\n      {rarity === 'secret_rare' && (\n        <div className=\"absolute inset-0 pointer-events-none\">\n          {[...Array(20)].map((_, i) => (\n            <div\n              key={`bg-sparkle-${i}`}\n              className=\"absolute text-2xl animate-pulse\"\n              style={{\n                top: `${Math.random() * 100}%`,\n                left: `${Math.random() * 100}%`,\n                animationDelay: `${Math.random() * 4}s`,\n                animationDuration: `${2 + Math.random() * 2}s`,\n                color: ['#EC4899', '#8B5CF6', '#3B82F6', '#10B981', '#F59E0B'][Math.floor(Math.random() * 5)]\n              }}\n            >\n              âœ¨\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default RarityCelebration;"